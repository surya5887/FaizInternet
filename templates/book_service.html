{% extends "base.html" %}

{% block title %}Book {{ service.title }} - Faiz Internet{% endblock %}

{% block extra_css %}
<style>
    .booking-wrapper {
        padding: 80px 0;
        background: var(--background);
        background-image: var(--gradient-bg);
        min-height: calc(100vh - 200px);
    }
    .service-header {
        display: flex;
        align-items: center;
        gap: 25px;
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid rgba(155, 93, 229, 0.15);
    }
    .service-header .service-icon-box {
        width: 100px;
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(155, 93, 229, 0.08);
        border-radius: 20px;
        border: 1px solid rgba(155, 93, 229, 0.2);
        flex-shrink: 0;
    }
    .service-header .service-icon-box i {
        font-size: 2.5rem;
        color: var(--accent-purple);
    }
    .service-title {
        font-size: 2.2rem;
        color: var(--white);
        margin-bottom: 8px;
    }
    .grid-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    .full-width {
        grid-column: 1 / -1;
    }
    .info-box {
        background: rgba(155, 93, 229, 0.05);
        border-left: 4px solid var(--accent-purple);
        padding: 20px;
        border-radius: var(--border-radius-sm);
        margin-bottom: 30px;
        font-size: 0.95rem;
        color: var(--white);
    }
    .doc-upload-section {
        margin-top: 30px;
        padding-top: 30px;
        border-top: 1px solid rgba(155, 93, 229, 0.15);
    }
    .doc-upload-field {
        background: rgba(155, 93, 229, 0.04);
        padding: 20px;
        border-radius: var(--border-radius-md);
        border: 1px solid rgba(155, 93, 229, 0.1);
        margin-bottom: 15px;
    }
    .doc-upload-field label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--white);
    }
    .doc-upload-field label i {
        color: var(--accent-purple);
    }
    @media (max-width: 768px) {
        .grid-form { grid-template-columns: 1fr; }
        .service-header { flex-direction: column; text-align: center; }
    }
</style>
{% endblock %}

{% block content %}
<div class="booking-wrapper">
    <div class="container" style="max-width: 900px;">
        <div class="premium-card premium-form">
            
            <div class="service-header">
                <div class="service-icon-box">
                    <i class="fa-solid fa-file-lines"></i>
                </div>
                <div>
                    <h2 class="service-title">Apply for {{ service.title }}</h2>
                    <p style="color: var(--text-light); font-size: 1.1rem; margin: 0;">{{ service.description }}</p>
                </div>
            </div>

            <div class="info-box">
                <i class="fa-solid fa-circle-user" style="margin-right: 10px; font-size: 1.2rem; color: var(--accent-purple);"></i>
                Applying as <strong style="color: var(--accent-gold);">{{ current_user.name }}</strong> ({{ current_user.phone }}). We will contact you at <strong style="color: var(--accent-gold);">{{ current_user.email }}</strong> regarding this application.
            </div>

            <form method="POST" action="{{ url_for('book_service', service_id=service.id) }}" enctype="multipart/form-data">
                
                <div class="form-group full-width">
                    <label>Application Type</label>
                    <select name="application_type" class="form-control">
                        <option value="New Application">New Application</option>
                        <option value="Correction / Update">Correction / Update</option>
                        <option value="Replacement / Reprint">Replacement / Reprint</option>
                    </select>
                </div>

                <div class="grid-form">
                    {% if schema %}
                        {% for field in schema %}
                            <div class="form-group {% if field.type == 'textarea' %}full-width{% endif %}">
                                <label for="{{ field.name }}">{{ field.label }} {% if field.required %}<span style="color:var(--accent-orange);">*</span>{% endif %}</label>
                                
                                {% if field.type == 'textarea' %}
                                    <textarea id="{{ field.name }}" name="{{ field.name }}" class="form-control" rows="3" {% if field.required %}required{% endif %}></textarea>
                                {% elif field.type == 'date' %}
                                    <input type="date" id="{{ field.name }}" name="{{ field.name }}" class="form-control" {% if field.required %}required{% endif %}>
                                {% elif field.type == 'select' %}
                                    <select id="{{ field.name }}" name="{{ field.name }}" class="form-control" {% if field.required %}required{% endif %}>
                                        <option value="">-- Select --</option>
                                        {% for opt in field.get('options', []) %}
                                        <option value="{{ opt }}">{{ opt }}</option>
                                        {% endfor %}
                                    </select>
                                {% else %}
                                    <input type="{{ field.type }}" id="{{ field.name }}" name="{{ field.name }}" class="form-control" {% if field.required %}required{% endif %}>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- Dynamic Document Upload Fields -->
                {% if doc_fields %}
                <div class="doc-upload-section">
                    <h3 style="color: var(--white); font-size: 1.3rem; margin-bottom: 20px;">
                        <i class="fa-solid fa-cloud-arrow-up" style="color: var(--accent-purple); margin-right: 10px;"></i> Upload Required Documents
                    </h3>
                    {% for doc_field in doc_fields %}
                    <div class="doc-upload-field">
                        <label>
                            <i class="fa-solid fa-file-arrow-up"></i>
                            {{ doc_field.label }} {% if doc_field.required %}<span style="color: var(--accent-orange); font-size: 0.85rem;">*Required</span>{% else %}<span style="color: var(--text-light); font-size: 0.8rem;">(Optional)</span>{% endif %}
                        </label>
                        <input type="file" name="doc_field_{{ loop.index0 }}" class="form-control" accept=".pdf,.jpg,.jpeg,.png" {% if doc_field.required %}required{% endif %}>
                        <p style="font-size: 0.78rem; color: var(--text-light); margin: 8px 0 0 0;">Accepted: PDF, JPG, PNG (Max 16MB)</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- Fallback single document upload -->
                <div class="form-group full-width" style="margin-top: 10px; border-top: 1px solid rgba(155, 93, 229, 0.15); padding-top: 30px;">
                    <label>Upload Supporting Documents (Optional)</label>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 15px;">Please upload a clear PDF, JPG, or PNG containing any existing documents or proofs (Max 16MB).</p>
                    <input type="file" name="document" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                </div>
                {% endif %}

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px; font-size: 1.1rem; padding: 18px;">
                    <i class="fa-solid fa-paper-plane" style="margin-right: 10px;"></i> Submit Secure Application
                </button>
            </form>
            
        </div>
    </div>
</div>
{% endblock %}
