{% extends "admin_base.html" %}

{% block page_title %}User Management{% endblock %}

{% block content %}
<div class="table-container">
    <div class="table-header">
        <h3 class="table-title">Registered Users ({{ users|length }})</h3>
        <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Manage platform roles and access.</p>
    </div>
    
    <div style="overflow-x: auto;">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>#{{ user.id }}</td>
                    <td style="font-weight: 500;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="avatar" style="width: 28px; height: 28px; font-size: 0.8rem;">
                                {{ user.name[0] | upper }}
                            </div>
                            {{ user.name }}
                        </div>
                    </td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>
                        {% if user.role == 'admin' %}
                            <span class="badge admin"><i class="fas fa-crown"></i> Admin</span>
                        {% else %}
                            <span class="badge user"><i class="fas fa-user"></i> User</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <!-- Change Role Form -->
                            <form method="POST" action="{{ url_for('update_user_role', user_id=user.id) }}" style="display: inline-block;">
                                {% if user.role == 'admin' %}
                                    <input type="hidden" name="role" value="user">
                                    <button type="submit" class="btn btn-sm btn-outline" {% if current_user.id == user.id %}disabled{% endif %} title="Demote to User">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                {% else %}
                                    <input type="hidden" name="role" value="admin">
                                    <button type="submit" class="btn btn-sm btn-outline" title="Promote to Admin">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                {% endif %}
                            </form>
                            
                            <!-- Delete Form -->
                            <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" style="display: inline-block;" onsubmit="return confirm('Are you sure you want to delete this user and all their applications? This cannot be undone.');">
                                <button type="submit" class="btn btn-sm btn-danger" {% if current_user.id == user.id %}disabled{% endif %} title="Delete User">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);">
                        No users found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
